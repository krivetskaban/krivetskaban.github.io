<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            backdrop-filter: blur(10px);
        }
        button {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .info {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            word-break: break-all;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .error { color: #ff6b6b; }
        .success { color: #4CAF50; }
        .warning { color: #ffa500; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h2>üîç –¢–µ—Å—Ç Mini App</h2>
            <p>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–æ—Ç—É</p>
        </div>

        <div class="card">
            <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebApp</h3>
            <div class="info" id="webappInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div class="card">
            <h3>üë§ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <div class="info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>

        <div class="card">
            <h3>üß™ –¢–µ—Å—Ç—ã</h3>
            <button onclick="testSubscriptionCheck()" id="testBtn1">
                üîç –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
            </button>
            <button onclick="testDataSend()" id="testBtn2">
                üì§ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            </button>
            <button onclick="clearLog()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
            </button>
        </div>

        <div class="card">
            <h3>üìù –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
            <div class="log" id="logContainer"></div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logContainer.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Mini App –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
                tg.ready();
                tg.expand();
                log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebApp
                const webappInfo = document.getElementById('webappInfo');
                webappInfo.innerHTML = `
                    <strong>–í–µ—Ä—Å–∏—è:</strong> ${tg.version}<br>
                    <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> ${tg.platform}<br>
                    <strong>–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:</strong> ${tg.colorScheme}<br>
                    <strong>–í—ã—Å–æ—Ç–∞ –æ–∫–Ω–∞:</strong> ${tg.viewportHeight}<br>
                    <strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ sendData:</strong> ${typeof tg.sendData === 'function' ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}
                `;
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userInfo = document.getElementById('userInfo');
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const user = tg.initDataUnsafe.user;
                    userInfo.innerHTML = `
                        <strong>ID:</strong> ${user.id}<br>
                        <strong>–ò–º—è:</strong> ${user.first_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}<br>
                        <strong>Username:</strong> @${user.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                        <strong>–Ø–∑—ã–∫:</strong> ${user.language_code || '–ù–µ —É–∫–∞–∑–∞–Ω'}
                    `;
                    log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.id} (@${user.username || '–±–µ–∑ username'})`, 'info');
                } else {
                    userInfo.innerHTML = '‚ùå –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã';
                    log('‚ùå –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', 'error');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ initData
                if (tg.initData) {
                    log(`üìã initData –ø–æ–ª—É—á–µ–Ω (–¥–ª–∏–Ω–∞: ${tg.initData.length})`, 'success');
                } else {
                    log('‚ùå initData –Ω–µ –ø–æ–ª—É—á–µ–Ω', 'error');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        });

        function testSubscriptionCheck() {
            const btn = document.getElementById('testBtn1');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º...';
            
            log('üîç –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ sendData
                if (typeof tg.sendData !== 'function') {
                    log('‚ùå tg.sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!', 'error');
                    btn.disabled = false;
                    btn.innerHTML = 'üîç –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏';
                    return;
                }
                
                // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const testData = {
                    action: 'check_subscription',
                    user_id: tg.initDataUnsafe?.user?.id,
                    test: true,
                    timestamp: Date.now()
                };
                
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData)}`, 'info');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                tg.sendData(JSON.stringify(testData));
                log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ tg.sendData', 'success');
                
                // –¢–∞–π–º–∞—É—Ç –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–Ω–æ–ø–∫–∏
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = 'üîç –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏';
                    log('‚è±Ô∏è –¢–∞–π–º–∞—É—Ç —Ç–µ—Å—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω', 'warning');
                }, 5000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`, 'error');
                btn.disabled = false;
                btn.innerHTML = 'üîç –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏';
            }
        }

        function testDataSend() {
            const btn = document.getElementById('testBtn2');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º...';
            
            log('üì§ –ù–∞—á–∏–Ω–∞–µ–º –æ–±—â–∏–π —Ç–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'info');
            
            try {
                const testData = {
                    action: 'test_connection',
                    message: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Mini App',
                    user_id: tg.initDataUnsafe?.user?.id,
                    timestamp: Date.now(),
                    random: Math.random()
                };
                
                log(`üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: ${JSON.stringify(testData, null, 2)}`, 'info');
                
                tg.sendData(JSON.stringify(testData));
                log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã', 'success');
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = 'üì§ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
                }, 3000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏: ${error.message}`, 'error');
                btn.disabled = false;
                btn.innerHTML = 'üì§ –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π Telegram
        tg.onEvent('mainButtonClicked', () => {
            log('üîò –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞', 'info');
        });

        tg.onEvent('backButtonClicked', () => {
            log('‚¨ÖÔ∏è –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ –Ω–∞–∂–∞—Ç–∞', 'info');
        });

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.onerror = function(message, source, lineno, colno, error) {
            log(`‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ${message} –≤ ${source}:${lineno}`, 'error');
            return false;
        };

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤
        window.addEventListener('unhandledrejection', function(event) {
            log(`‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–∏—Å–∞: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>